import logging
from telegram import Update, ReplyKeyboardMarkup, ReplyKeyboardRemove
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, filters, ContextTypes

# –í–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO
)
logger = logging.getLogger(__name__)

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–≤–µ—Å—Ç—ã —Å —à–∞–≥–∞–º–∏: –∫–∞–∂–¥—ã–π –∫–≤–µ—Å—Ç - —ç—Ç–æ —Å–ª–æ–≤–∞—Ä—å —à–∞–≥–æ–≤, —Ç–µ–∫—Å—Ç —à–∞–≥–∞ –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
QUESTS = {
    "castle": {
        "name": "–ö–≤–µ—Å—Ç: –ó–∞–º–æ–∫",
        "start_step": "start",
        "steps": {
            "start": {
                "text": "–í—ã —É –≤—Ö–æ–¥–∞ –≤ —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–º–æ–∫. –ß—Ç–æ –≤—ã —Å–¥–µ–ª–∞–µ—Ç–µ?",
                "options": ["‚û°Ô∏è –í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å", "‚¨ÖÔ∏è –û–±–æ–π—Ç–∏ –≤–æ–∫—Ä—É–≥", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚û°Ô∏è –í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å": {
                "text": "–í—ã –≤–æ—à–ª–∏ –∏ –≤–∏–¥–∏—Ç–µ –ª–µ—Å—Ç–Ω–∏—Ü—É –∏ –¥–≤–µ—Ä—å. –ö—É–¥–∞ –ø–æ–π–¥—ë—Ç–µ?",
                "options": ["‚¨ÜÔ∏è –ü–æ–¥–Ω—è—Ç—å—Å—è –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ", "üö™ –û—Ç–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚¨ÖÔ∏è –û–±–æ–π—Ç–∏ –≤–æ–∫—Ä—É–≥": {
                "text": "–û–±–æ–π–¥—è –∑–∞–º–æ–∫, –Ω–∞—à–ª–∏ –ø–æ—Ç–∞–π–Ω–æ–π –ø—Ä–æ—Ö–æ–¥. –í–æ–π—Ç–∏?",
                "options": ["üö∂‚Äç‚ôÇÔ∏è –í–æ–π—Ç–∏ –≤ –ø—Ä–æ—Ö–æ–¥", "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚¨ÜÔ∏è –ü–æ–¥–Ω—è—Ç—å—Å—è –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ": {
                "text": "–¢–∞–º –¥—Ä–∞–∫–æ–Ω! –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
                "options": ["‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è —Å –¥—Ä–∞–∫–æ–Ω–æ–º", "üèÉ‚Äç‚ôÇÔ∏è –ë–µ–∂–∞—Ç—å –≤–Ω–∏–∑", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üö™ –û—Ç–∫—Ä—ã—Ç—å –¥–≤–µ—Ä—å": {
                "text": "–°—É–Ω–¥—É–∫ —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏! –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º üéâ",
                "options": ["üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üö∂‚Äç‚ôÇÔ∏è –í–æ–π—Ç–∏ –≤ –ø—Ä–æ—Ö–æ–¥": {
                "text": "–¢–µ–º–Ω–æ, –≤—ã –Ω–∞—à–ª–∏ —Ç–∞–π–Ω—É—é –∫–æ–º–Ω–∞—Ç—É —Å –∫–Ω–∏–≥–æ–π.",
                "options": ["üìñ –í–∑—è—Ç—å –∫–Ω–∏–≥—É", "‚Ü©Ô∏è –í—ã–π—Ç–∏ –æ–±—Ä–∞—Ç–Ω–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è —Å –¥—Ä–∞–∫–æ–Ω–æ–º": {
                "text": "–í—ã –ø–æ–±–µ–¥–∏–ª–∏ –¥—Ä–∞–∫–æ–Ω–∞! –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! üèÜ",
                "options": ["üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üìñ –í–∑—è—Ç—å –∫–Ω–∏–≥—É": {
                "text": "–ö–Ω–∏–≥–∞ –≤–æ–ª—à–µ–±–Ω–∞—è! –í—ã –º–∞–≥. –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! ‚ú®",
                "options": ["üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üèÉ‚Äç‚ôÇÔ∏è –ë–µ–∂–∞—Ç—å –≤–Ω–∏–∑": {
                "text": "–í–µ—Ä–Ω—É–ª–∏—Å—å –∫ –≤—Ö–æ–¥—É –≤ –∑–∞–º–æ–∫.",
                "options": ["‚û°Ô∏è –í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å", "‚¨ÖÔ∏è –û–±–æ–π—Ç–∏ –≤–æ–∫—Ä—É–≥", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É": {
                "text": "–í—ã —É –≤—Ö–æ–¥–∞ –≤ –∑–∞–º–æ–∫.",
                "options": ["‚û°Ô∏è –í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å", "‚¨ÖÔ∏è –û–±–æ–π—Ç–∏ –≤–æ–∫—Ä—É–≥", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚Ü©Ô∏è –í—ã–π—Ç–∏ –æ–±—Ä–∞—Ç–Ω–æ": {
                "text": "–í—ã —É –≤—Ö–æ–¥–∞ –≤ –∑–∞–º–æ–∫.",
                "options": ["‚û°Ô∏è –í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å", "‚¨ÖÔ∏è –û–±–æ–π—Ç–∏ –≤–æ–∫—Ä—É–≥", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ": {
                "text": "–í—ã —É –≤—Ö–æ–¥–∞ –≤ –∑–∞–º–æ–∫. –ß—Ç–æ –¥–∞–ª—å—à–µ?",
                "options": ["‚û°Ô∏è –í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å", "‚¨ÖÔ∏è –û–±–æ–π—Ç–∏ –≤–æ–∫—Ä—É–≥", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
        },
    },
    "cave": {
        "name": "–ö–≤–µ—Å—Ç: –ü–µ—â–µ—Ä–∞",
        "start_step": "start",
        "steps": {
            "start": {
                "text": "–í—ã —Å—Ç–æ–∏—Ç–µ —É –≤—Ö–æ–¥–∞ –≤ —Ç–µ–º–Ω—É—é –ø–µ—â–µ—Ä—É. –ß—Ç–æ –≤—ã —Å–¥–µ–ª–∞–µ—Ç–µ?",
                "options": ["‚û°Ô∏è –í–æ–π—Ç–∏ –≤ –ø–µ—â–µ—Ä—É", "‚¨ÖÔ∏è –û—Ç–æ–π—Ç–∏ –Ω–∞–∑–∞–¥", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚û°Ô∏è –í–æ–π—Ç–∏ –≤ –ø–µ—â–µ—Ä—É": {
                "text": "–í–Ω—É—Ç—Ä–∏ —Å–ª—ã—à–Ω—ã —Å—Ç—Ä–∞–Ω–Ω—ã–µ –∑–≤—É–∫–∏ –∏ –≤–∏–¥–Ω–µ–µ—Ç—Å—è —Å–≤–µ—Ç–ª—ã–π –ø—Ä–æ—Ö–æ–¥. –ö—É–¥–∞ –ø–æ–π–¥—ë—Ç–µ?",
                "options": ["‚û°Ô∏è –ò–¥—Ç–∏ –Ω–∞ —Å–≤–µ—Ç", "üëÇ –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–≤—É–∫", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚¨ÖÔ∏è –û—Ç–æ–π—Ç–∏ –Ω–∞–∑–∞–¥": {
                "text": "–í—ã —Ä–µ—à–∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–π—Ç–∏ –¥–æ–º–æ–π. –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω.",
                "options": ["üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚û°Ô∏è –ò–¥—Ç–∏ –Ω–∞ —Å–≤–µ—Ç": {
                "text": "–í—ã –≤—ã—à–ª–∏ –≤ –∫—Ä–∞—Å–∏–≤—ã–π –ø–æ–¥–∑–µ–º–Ω—ã–π —Å–∞–¥, –ø–æ–ª–Ω—ã–π —Å–∏—è—é—â–∏—Ö —Ü–≤–µ—Ç–æ–≤. –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! üå∏",
                "options": ["üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üëÇ –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–≤—É–∫": {
                "text": "–ó–≤—É–∫ –æ–∫–∞–∑–∞–ª—Å—è —à–∏–ø–µ–Ω–∏–µ–º –∑–º–µ–∏! –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
                "options": ["‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è", "üèÉ‚Äç‚ôÇÔ∏è –£–±–µ–∂–∞—Ç—å", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "‚öîÔ∏è –°—Ä–∞–∑–∏—Ç—å—Å—è": {
                "text": "–í—ã –ø–æ–±–µ–¥–∏–ª–∏ –∑–º–µ—é! –ì–µ—Ä–æ–π! –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! üèÜ",
                "options": ["üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üèÉ‚Äç‚ôÇÔ∏è –£–±–µ–∂–∞—Ç—å": {
                "text": "–í—ã —É–±–µ–∂–∞–ª–∏ –∏–∑ –ø–µ—â–µ—Ä—ã, —Å–ø–∞—Å–∞—è—Å—å –æ—Ç –æ–ø–∞—Å–Ω–æ—Å—Ç–∏.",
                "options": ["üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
            "üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ": {
                "text": "–í—ã —É –≤—Ö–æ–¥–∞ –≤ –ø–µ—â–µ—Ä—É. –ß—Ç–æ –¥–∞–ª—å—à–µ?",
                "options": ["‚û°Ô∏è –í–æ–π—Ç–∏ –≤ –ø–µ—â–µ—Ä—É", "‚¨ÖÔ∏è –û—Ç–æ–π—Ç–∏ –Ω–∞–∑–∞–¥", "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é"],
            },
        },
    },
}

# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–≤–µ—Å—Ç–∞–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–≤–µ—Å—Ç–∞
    keyboard = [[quest["name"]] for quest in QUESTS.values()]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True, one_time_keyboard=True)
    await update.message.reply_text(
        "–ü—Ä–∏–≤–µ—Ç! –í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–µ—Å—Ç, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å:",
        reply_markup=reply_markup,
    )
    context.user_data.clear()  # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –º–µ–Ω—é –∫–≤–µ—Å—Ç–æ–≤ –∏–ª–∏ —à–∞–≥–æ–≤ –∫–≤–µ—Å—Ç–∞
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = update.message.text  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_data = context.user_data  # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
    if text == "üîô –ü—Ä–µ—Ä–≤–∞—Ç—å –∫–≤–µ—Å—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é":
        user_data.clear()
        await start(update, context)
        return

    # –ï—Å–ª–∏ –∫–≤–µ—Å—Ç –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–≤–µ—Å—Ç –∏–∑ –º–µ–Ω—é
    if "current_quest" not in user_data:
        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∫–≤–µ—Å—Ç –ø–æ –∏–º–µ–Ω–∏
        for key, quest in QUESTS.items():
            if text == quest["name"]:
                user_data["current_quest"] = key  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–≤–µ—Å—Ç
                user_data["current_step"] = quest["start_step"]  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —à–∞–≥
                await send_quest_step(update, user_data)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —à–∞–≥ –∫–≤–µ—Å—Ç–∞
                return
        # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω, –ø—Ä–æ—Å–∏–º –≤—ã–±—Ä–∞—Ç—å –∫–≤–µ—Å—Ç
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–≤–µ—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É—è –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ.",
        )
        return

    # –ï—Å–ª–∏ –∫–≤–µ—Å—Ç —É–∂–µ –≤—ã–±—Ä–∞–Ω, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —à–∞–≥–æ–≤ –∫–≤–µ—Å—Ç–∞
    current_quest = user_data["current_quest"]
    current_step_key = user_data.get("current_step")
    quest = QUESTS[current_quest]
    steps = quest["steps"]

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —à–∞–≥–µ
    if current_step_key is None or current_step_key not in steps:
        # –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–≤–µ—Å—Ç
        await update.message.reply_text(
            "–û—à–∏–±–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ.",
        )
        user_data.clear()  # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await start(update, context)  # –ó–∞–ø—É—Å–∫–∞–µ–º –º–µ–Ω—é –∑–∞–Ω–æ–≤–æ
        return

    options = steps[current_step_key]["options"]
    if text not in options:
        # –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞.",
        )
        return

    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
    user_data["current_step"] = text

    # –ï—Å–ª–∏ —à–∞–≥ —Ç–µ–∫—Å—Ç–∞ "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —à–∞–≥ –∫–≤–µ—Å—Ç–∞ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—ã–π
    if text == "üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ":
        user_data["current_step"] = quest["start_step"]

    await send_quest_step(update, user_data)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –∫–≤–µ—Å—Ç–∞

# –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º —à–∞–≥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
async def send_quest_step(update: Update, user_data: dict) -> None:
    current_quest = user_data["current_quest"]
    current_step_key = user_data["current_step"]
    quest = QUESTS[current_quest]
    steps = quest["steps"]
    step = steps.get(current_step_key)

    if step is None:
        await update.message.reply_text("–û—à–∏–±–∫–∞: –®–∞–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return

    text = step["text"]
    options = step["options"]
    keyboard = [[option] for option in options]  # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True, one_time_keyboard=True)

    await update.message.reply_text(text=text, reply_markup=reply_markup)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —à–∞–≥–æ–º

def main() -> None:
    TOKEN = "7567135692:AAGERrXNJ2-02yZwG4zo0g0i5i7DSoTYHz0"  # –¢–æ–∫–µ–Ω –±–æ—Ç–∞

    application = ApplicationBuilder().token(TOKEN).build()  # –°–æ–∑–¥–∞—ë–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞

    application.add_handler(CommandHandler("start", start))  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

    print("Bot is running...")  # –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
    application.run_polling()  # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞

if __name__ == '__main__':
    main()  # –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞

